# Enable mod_rewrite
RewriteEngine On

# Redirect requests for index.php to the root
RewriteRule ^index\.php$ / [R=301,L]

# Handle requests for static files
RewriteCond %{REQUEST_URI} ^/_next/static/
RewriteRule ^(_next/static/.*)$ http://localhost:3008/$1 [P,L]

# Reverse proxy to http://localhost:3008 for the main domain
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^(.*)$ http://localhost:3008/$1 [P,L]

# Reverse proxy to http://localhost:3007 for /backend path
RewriteCond %{REQUEST_URI} ^/backend
RewriteRule ^backend/(.*)$ http://localhost:3007/$1 [P,L]

# Set headers for proxying
<IfModule mod_headers.c>
    RequestHeader set X-Forwarded-Proto "https" env=HTTPS
    RequestHeader set X-Forwarded-For %{REMOTE_ADDR}s
</IfModule>

# Disable directory listing
Options -Indexes

# Ensure all routes are directed to Next.js
FallbackResource /